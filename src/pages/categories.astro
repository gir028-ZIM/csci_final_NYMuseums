---
import Layout from '../layouts/Layout.astro';
import museums from '../data/museums_clean.json';

interface Museum {
  the_geom: string;
  name: string;
  tel: string;
  url: string;
  address1: string;
  address2: string;
  city: string;
  zip: string;
  category: string;
  review: string;
}

// Support both cleaned-array and original OpenData payloads
const rows = Array.isArray(museums as any) ? (museums as any) : ((museums as any).data || []);

const museumList: Museum[] = rows.map((row: any) => ({
  the_geom: row.the_geom ?? row[8],
  name: row.name ?? row[9],
  tel: row.tel ?? row[10],
  url: row.url ?? row[11],
  address1: row.address1 ?? row[12] ?? row.adress1 ?? '',
  address2: row.address2 ?? row[13] ?? '',
  city: row.city ?? row[14] ?? '',
  zip: row.zip ?? row[15] ?? '',
  category: row.category ?? '',
  review: row.review ?? ''
}));

const categories = [...new Set(museumList.map(m => m.category))].sort();
---

<Layout title="Categories - NYC Museums Directory">
  <header>
    <h1>üé® Categories</h1>
    <p>Explore the type of museum you want to visit</p>
  </header>
  
  <nav>
    <ul>
      <li><a href="/">Home</a></li>
      <li><a href="/locations/">By Location</a></li>
      <li><a href="/categories/">By Category</a></li>
      <li><a href="/reviews/">Reviews</a></li>
    </ul>
  </nav>
  
  <section class="page-title">
    <h1>All Categories</h1>
    <p>Click on a category to explore museums</p>
  </section>
  
  <div class="categories-grid">
    {categories.map(category => {
      const count = museumList.filter(m => m.category === category).length;
      const slug = category.toLowerCase().replace(/\s+/g, '-');
      const icons = {
        'Art': 'üé®',
        'History': 'üìö',
        'Science': 'üî¨'
      };
      const icon = icons[category as keyof typeof icons] || 'üèõÔ∏è';
      
      return (
        <a href={`/categories/${slug}/`} class="category-card">
          <div class="icon">{icon}</div>
          <h2>{category}</h2>
          <div class="count">{count} Museums</div>
        </a>
      );
    })}
  </div>
  
  <footer>
    <p>&copy; 2025 NYC Museums Directory | Data from NYC OpenData</p>
  </footer>
</Layout>

<style>
  header {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    color: white;
    padding: 2rem 1rem;
    text-align: center;
    margin: -20px -20px 2rem -20px;
    padding-left: calc(1rem + 20px);
    padding-right: calc(1rem + 20px);
  }
  
  header h1 {
    font-size: 2.5rem;
    margin-bottom: 0.5rem;
  }
  
  header p {
    font-size: 1.1rem;
    opacity: 0.9;
  }
  
  nav {
    background-color: white;
    padding: 1rem;
    border-radius: 8px;
    box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    margin-bottom: 2rem;
  }
  
  nav ul {
    list-style: none;
    display: flex;
    gap: 2rem;
    justify-content: center;
    flex-wrap: wrap;
  }
  
  nav a {
    color: #667eea;
    text-decoration: none;
    font-weight: 500;
    transition: color 0.3s;
  }
  
  nav a:hover {
    color: #764ba2;
  }
  
  .page-title {
    background: white;
    padding: 2rem;
    border-radius: 8px;
    margin-bottom: 2rem;
    box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    text-align: center;
  }
  
  .page-title h1 {
    color: #667eea;
    font-size: 2rem;
    margin-bottom: 0.5rem;
  }
  
  .page-title p {
    color: #666;
    font-size: 1.1rem;
  }
  
  .categories-grid {
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    gap: 2rem;
    margin-bottom: 3rem;
  }
  
  .category-card {
    background: white;
    border-radius: 8px;
    padding: 2rem;
    box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    transition: transform 0.3s, box-shadow 0.3s;
    text-decoration: none;
    color: inherit;
    border: 2px solid transparent;
    display: flex;
    flex-direction: column;
    align-items: center;
    text-align: center;
  }
  
  .category-card:hover {
    transform: translateY(-4px);
    box-shadow: 0 4px 16px rgba(0,0,0,0.15);
    border-color: #667eea;
  }
  
  .category-card .icon {
    font-size: 3rem;
    margin-bottom: 1rem;
  }
  
  .category-card h2 {
    color: #667eea;
    margin-bottom: 0.5rem;
    font-size: 1.5rem;
  }
  
  .category-card .count {
    color: #666;
    font-size: 0.95rem;
  }
  
  @media (max-width: 768px) {
    .categories-grid {
      grid-template-columns: repeat(2, 1fr);
    }
  }
  
  @media (max-width: 480px) {
    .categories-grid {
      grid-template-columns: 1fr;
    }
  }
  
  footer {
    background-color: #333;
    color: white;
    text-align: center;
    padding: 2rem;
    margin: 3rem -20px -20px -20px;
  }
</style>
